<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Import Data - Book Express</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/import.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar (copied from dashboard.html for consistency) -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2 class="logo">Book Express</h2>
            </div>
            <nav class="sidebar-menu">
                <div class="menu-section">
                    <ul>
                        <li><a href="dashboard.html" class="menu-item" data-section="dashboard"><span class="icon"><i class="fas fa-home"></i></span> Dashboard</a></li>
                        <li><a href="inventory.html" class="menu-item" data-section="inventory"><span class="icon"><i class="fas fa-boxes"></i></span> Inventory</a></li>
                        <li><a href="catalogue.html" class="menu-item" data-section="catalogue"><span class="icon"><i class="fas fa-book"></i></span> Catalogue</a></li>
                        <li><a href="low-stock.html" class="menu-item" data-section="low-stock"><span class="icon"><i class="fas fa-exclamation-circle"></i></span> Low Stock Alerts</a></li>
                    </ul>
                </div>
                <div class="menu-section">
                    <h3 class="menu-title">ADMIN</h3>
                    <ul>
                        <li><a href="analytics.html" class="menu-item" data-section="analytics"><span class="icon"><i class="fas fa-chart-bar"></i></span> Analytics</a></li>
                        <li><a href="import.html" class="menu-item active" data-section="import"><span class="icon"><i class="fas fa-upload"></i></span> Import Data</a></li>
                    </ul>
                </div>
                <div class="menu-section logout-section">
                    <ul>
                        <li><a href="#" class="menu-item logout" onclick="logout()"><span class="icon"><i class="fas fa-sign-out-alt"></i></span> Logout</a></li>
                    </ul>
                </div>
            </nav>
        </aside>
        <!-- Main Content -->
        <main class="main-content">
            <div class="topbar">
                <button class="sidebar-toggle" id="sidebarToggle">â˜°</button>
                <div class="topbar-right">
                    <div class="user-profile">
                        <div class="user-avatar" id="userInitial">C</div>
                        <div class="user-info">
                            <p class="user-name" id="userName">Manager</p>
                            <p class="user-role" id="userRole">Manager</p>
                        </div>
                    </div>
                </div>
            </div>
            <section id="import-section" class="content-section active">
                <div class="section-header">
                    <h1>Import Inventory & Sales Data</h1>
                    <p>Upload your CSV files to populate or update your inventory. Choose initial population or daily import.</p>
                </div>
                <div class="import-container">
                    <div class="import-options">
                        <button id="initialImportBtn" class="import-btn">Initial Inventory Import</button>
                        <button id="dailyImportBtn" class="import-btn">Daily Sales Import</button>
                    </div>
                    <div class="upload-box">
                        <input type="file" id="csvFileInput" accept=".csv" style="display:none;">
                        <label for="csvFileInput" class="upload-label">
                            <i class="fas fa-cloud-upload-alt fa-2x"></i>
                            <span>Upload CSV File</span>
                        </label>
                        <p>Drag & drop or browse. Supports .csv files only.</p>
                    </div>
                    <div class="csv-guidelines">
                        <h3>CSV Formatting Guidelines</h3>
                        <div class="guidelines-initial" id="guidelinesInitial" style="display:none;">
                            <h4>Initial Inventory Import</h4>
                            <p><strong>File Format:</strong> Item_sample.csv (from ZOHO export)</p>
                            <p><strong>Required Columns:</strong></p>
                            <ul>
                                <li><code>Item ID</code> - Unique item identifier (e.g., 7288706000000093261)</li>
                                <li><code>Item Name</code> - Full name of the item</li>
                                <li><code>Rate</code> - Price in format "JMD XXXX.XX"</li>
                                <li><code>Product Type</code> - Type of product (e.g., "goods")</li>
                                <li><code>Status</code> - Item status (e.g., "Active")</li>
                            </ul>
                            <p><strong>Notes:</strong> Quantity will be automatically set to 0. All existing items will be skipped. File can have additional columns (they will be ignored).</p>
                        </div>
                        <div class="guidelines-daily" id="guidelinesDaily" style="display:none;">
                            <h4>Daily Sales Import</h4>
                            <p><strong>File Format:</strong> Sales_by_Item_sample.csv (from ZOHO export)</p>
                            <p><strong>Required Columns:</strong></p>
                            <ul>
                                <li><code>item_id</code> - Item ID (must match an Item ID from initial import)</li>
                                <li><code>item_name</code> - Item name (for reference)</li>
                                <li><code>quantity_sold</code> - Number of units sold</li>
                                <li><code>amount</code> - Total sale amount</li>
                                <li><code>average_price</code> - Price per unit (must be within 10% of stored rate)</li>
                            </ul>
                            <p><strong>Notes:</strong> Items not found in inventory will be marked as "unrecognized". Price mismatches > 10% will be flagged as discrepancies.</p>
                        </div>
                        <ul id="guidelinesList">
                            <!-- Guidelines will be dynamically updated based on import type -->
                        </ul>
                        <button id="downloadTemplateBtn" class="template-btn"><i class="fas fa-download"></i> Download Template</button>
                    </div>
                    <div class="import-logs">
                        <h3><i class="fas fa-history"></i> Recent Import Activity</h3>
                        <div class="logs-list" id="importLogsList">
                            <p style="color: #999; text-align: center; padding: 1rem;">No imports yet. Upload a CSV file to see import history.</p>
                        </div>
                    </div>
                </div>
                <div class="import-summary" id="importSummary" style="display:none;">
                    <h3>Import Summary</h3>
                    <div class="summary-details">
                        <p><strong>Processed:</strong> <span id="processedCount">0</span></p>
                        <p><strong>Successful:</strong> <span id="successfulCount">0</span></p>
                        <p><strong>Unrecognized:</strong> <span id="unrecognizedCount">0</span></p>
                        <p><strong>Discrepancies:</strong> <span id="discrepanciesCount">0</span></p>
                        <p><strong>Errors:</strong> <span id="errorsCount">0</span></p>
                    </div>
                    <button id="downloadErrorLogBtn" class="error-log-btn"><i class="fas fa-file-alt"></i> Download Error Log</button>
                </div>
                <div class="import-alert" id="importAlert" style="display:none;">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="alertMessage">Average price mismatch detected. Import queued. Please review item details.</span>
                    <div class="alert-actions">
                        <button id="updateItemBtn" class="alert-btn">Update Item Details</button>
                        <button id="ignorePriceBtn" class="alert-btn">Ignore & Continue</button>
                    </div>
                </div>
            </section>
        </main>
    </div>
    <script src="js/auth.js"></script>
    <script src="js/import.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics - Book Express</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="./css/dashboard.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    .content-area { padding: 30px; }
    .controls { text-align: center; margin-bottom: 30px; }
    .controls select, .controls button {
      padding: 12px 20px; border-radius: 8px; font-size: 15px; margin: 0 8px;
    }
    .controls select { background: #1a2a42; border: 1px solid var(--border-color); color: var(--text-primary); }
    .controls button { background: var(--primary-color); color: white; border: none; cursor: pointer; }
    .controls button:hover { background: #0052cc; }

    .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 40px; }
    .metric-card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; text-align: center; }
    .metric-card h3 { font-size: 14px; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
    .metric-card .value { font-size: 36px; font-weight: 700; color: var(--text-primary); }
    .metric-card .change { font-size: 13px; margin-top: 8px; }
    .change.positive { color: var(--success-color); }
    .change.negative { color: var(--danger-color); }

    .chart-container { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; margin-bottom: 30px; }
    .chart-container h2 { margin: 0 0 20px 0; font-size: 20px; color: var(--text-primary); }

    #slowMoving { list-style: none; padding: 0; }
    #slowMoving li { background: rgba(239,68,68,0.15); border-left: 4px solid var(--danger-color); padding: 16px; margin-bottom: 12px; border-radius: 8px; color: var(--text-primary); }

    .error { background: rgba(239,68,68,0.2); color: #ff6b6b; padding: 16px; border-radius: 8px; text-align: center; max-width: 600px; margin: 20px auto; border: 1px solid rgba(239,68,68,0.3); }

    .chart-container { min-height: 45vh; }
    .chart-container canvas { background: transparent !important; display: block; width: 100%; height: auto; }
  </style>
</head>
<body>

<div class="dashboard-container">
  <!-- Full Sidebar + Logout at bottom -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h2 class="logo">Book Express</h2>
    </div>
    <nav class="sidebar-menu">
      <div class="menu-section">
        <ul>
          <li><a href="dashboard.html" class="menu-item" data-section="dashboard"><span class="icon"><i class="fas fa-tachometer-alt"></i></span> Dashboard</a></li>
          <li><a href="inventory.html" class="menu-item" data-section="inventory"><span class="icon"><i class="fas fa-boxes"></i></span> Inventory</a></li>
          <li><a href="catalogue.html" class="menu-item" data-section="catalogue"><span class="icon"><i class="fas fa-book"></i></span> Catalogue</a></li>
          <li><a href="low-stock.html" class="menu-item" data-section="low-stock"><span class="icon"><i class="fas fa-exclamation-triangle"></i></span> Low Stock Alerts</a></li>
        </ul>
      </div>
      <div class="menu-section">
        <h3 class="menu-title">ADMIN</h3>
        <ul>
          <li><a href="users.html" class="menu-item" data-section="users"><span class="icon"><i class="fas fa-users"></i></span> User Management</a></li>
          <li><a href="analytics.html" class="menu-item active"><span class="icon"><i class="fas fa-chart-bar"></i></span> Analytics</a></li>
          <li><a href="import.html" class="menu-item" data-section="import"><span class="icon"><i class="fas fa-upload"></i></span> Import Data</a></li>
          <li><a href="activity.html" class="menu-item" data-section="activity"><span class="icon"><i class="fas fa-history"></i></span> Activity Log</a></li>
        </ul>
      </div>
    </nav>

    <!-- Logout at the very bottom -->
    <div class="logout-section">
      <a href="login.html" class="menu-item logout">
        <span class="icon"><i class="fas fa-sign-out-alt"></i></span> Logout
      </a>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Topbar with sidebar toggle and user profile to match dashboard layout -->
    <div class="topbar">
      <button class="sidebar-toggle" id="sidebarToggle">â˜°</button>
      <div class="topbar-right">
        <div class="user-profile">
          <div class="user-avatar">M</div>
          <div class="user-info">
            <p class="user-name">manager</p>
            <p class="user-role">Admin</p>
          </div>
        </div>
      </div>
    </div>

    <div class="content-area">
      <h1 style="margin-top:0; margin-bottom:30px; text-align:center;">Analytics Dashboard</h1>

      <div class="controls">
        <select id="period" aria-label="Select time period">
          <option value="7">Last 7 Days</option>
          <option value="30" selected>Last 30 Days</option>
          <option value="90">Last 90 Days</option>
        </select>
        <button onclick="loadAnalytics()">Refresh Data</button>
      </div>

      <div id="errorMessage" class="error" style="display:none;"></div>
      <div class="metrics" id="metrics"></div>

      <div class="chart-container"><h2>Top 10 Sellers</h2><canvas id="topChart"></canvas></div>
      <div class="chart-container"><h2>Sales by Grade Level</h2><canvas id="gradeChart"></canvas></div>
      <div class="chart-container"><h2>Sales by Subject</h2><canvas id="subjectChart"></canvas></div>

      <div style="margin-top:20px; text-align:center;">
        <button id="runDiagnosticsBtn" style="background:#4b5563; color:#fff; padding:10px 16px; border-radius:8px; border:none; cursor:pointer;">Run Diagnostics</button>
      </div>

      <div id="diagnostics" class="chart-container" style="margin-top:18px; padding:16px;">
        <h2>Diagnostics</h2>
        <div id="diagResults" style="color:var(--text-primary); font-size:13px; white-space:pre-wrap; max-height:40vh; overflow:auto; background:transparent; padding:8px;"></div>
      </div>

      <h2>Slow-Moving Inventory (0 sales in selected period, stock > 0)</h2>
      <ul id="slowMoving"></ul>
    </div>
  </div>
</div>

<script>
  Chart.defaults.color = '#e0e6ff';
  Chart.defaults.borderColor = '#2a3a52';
</script>
<script src="js/auth.js"></script>
<script src="js/analytics.js"></script>
<script src="js/dashboard.js"></script>

</body>
</html>